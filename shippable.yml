language: php

php: 
  - 5.4
  - 5.5

matrix:
  allow_failures:
    - php: 5.5

services:
  - mongodb

env:
    secure: NSB6/hTI44DvqaLzvOJF9873Isg5q7Tkyzls9FkY/XcNToaVzGIqjwtrJWt7OkCl51C/u2s60v7BDFRUiSclHZuYQrz9GxmF4bFI8U6ulkj6eC0+iaWc0rbdPkrCAOuXggPRHhcHcf6NpK3Z1QnEksumaVC2Hp+cWJrxFipzb+NkhStiSs0g6LkbA9IOhs9SuL1Ol5LlNy6DIPzQXxohSz4+X4Gp1gagtsv8a6TsJvp9vlusOo86Az2b6DjXHKrVGUkiYh9UhlTexKZftg7EF8DaMv2rrD/Q6NsEY8kciWnuAOtKQm4OA4Ngm2jf7F/O2VSCeP4mH5KcPBPZIvbSXg==

before_script: 
  - mkdir -p shippable/testresults
  - mkdir -p shippable/codecoverage
  - git config --global user.email "ci@zoopcommerce.com"
  - git config --global user.name "zoop-ci"
  - echo "extension=mongo.so" >> ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini
  - echo "xdebug.max_nesting_level = 1000" >> ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini
  - composer config -g github-oauth.github.com $GITHUB_TOKEN
  - composer self-update
  - composer install

script:
  - phpunit --log-junit shippable/testresults/junit.xml --coverage-clover shippable/codecoverage/clover.xml tests/
  - vendor/bin/phpcs --standard=PSR2 src/ tests/Zoop/
  - vendor/bin/phpmd src/ text ruleset.xml

notifications:
   email: false